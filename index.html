
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Go 2 Class 4 Me</title>

    <!-- Bootstrap core CSS -->
    <link href="dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <!-- <link href="../../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet"> -->

    <!-- Custom styles for this template -->
    <link href="starter-template.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <!-- <script src="../../assets/js/ie-emulation-modes-warning.js"></script> -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>

          <a class="navbar-brand" href="#">Go 2 Class 4 Me</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#intro">Introduction</a></li>
            <li><a href="#obj">Project Objective</a></li>
            <li><a href="#design">Design</a></li>
            <li><a href="#testing">Testing</a></li>
            <li><a href="#result">Result</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">

      <div class="starter-template">
        <h1>ECE 5725 Project : Go2Class4Me Robot</h1>
        <p class="lead">Created by:<br>Christine Ahn (cya6), Sophie He (bh377)</p>
      </div>

      <hr>
      <div class="center-block">
          <iframe width="640" height="360" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allowfullscreen></iframe>
          <h4 style="text-align:center;">Demonstration Video</h4>
      </div>

      <hr id="intro">

      <div style="text-align:center;">
              <h2>Introduction</h2>
              <p style="text-align: left;padding: 0px 30px;">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum lorem nulla, consectetur at leo vel, pretium bibendum nisl. Cras blandit quam a enim ultrices, eu convallis enim posuere. Donec eleifend enim sed purus consectetur, vitae cursus lectus varius. Vivamus consectetur felis nec est venenatis posuere. Phasellus vitae aliquet erat. In laoreet lacinia mollis. Quisque iaculis nisl fermentum pharetra lobortis. Donec rhoncus dui sem, ac molestie leo tristique vel. Phasellus in nibh feugiat, fringilla lectus in, elementum magna. Etiam quis dui condimentum, tempus ex in, dapibus est. Cras ut congue augue. Donec ac enim ex. Ut id tristique risus, vel porttitor quam. Sed ultricies enim eu nibh porttitor, vel sodales enim feugiat. Fusce volutpat venenatis magna ac ultrices. Curabitur eget urna ut nulla mattis convallis non eu diam.</p>
      </div>

    <hr id='obj'>

      <div class="row">
          <div class="col-md-4" style="text-align:center;">
          <img class="img-rounded" src="pics/1.jpg" alt="Generic placeholder image" width="240" height="240">
          </div>
          <div class="col-md-8" style="font-size:18px;">
          <h2>Project Objective:</h2>
          <ul>
              <li>Control the robot wirelessly using a phone.</li>
              <li>See and hear what the robot sees and hears through the phone.</li>
              <li>Feel that one could possibly have the robot go to class for them.</li>
          </ul>
          </div>
      </div>

    <hr id='design'>

      <div style="text-align:center;">
              <h2>Design</h2>
              <p style="text-align: left;padding: 0px 30px;">
              Put stuff from proposal here.
              <li>Socket Programming </li>
              <li>Built robot </li>
              <li>Configured servos </li>
              <li>Set up Camera and Microphone and livestreamed it online</li>
              <li>Set up phone's accelerometer information to send to pi </li>
          </p>
      </div>

    <hr id='camera'>

      <div style="text-align:center;">
              <h2>Camera</h2>
              <p style="text-align: left;padding: 0px 30px;">
              	Used the Rpi Camera.
              	We set up the camera on the pi as such :
              		detail steps in how its done.
              	Used this person's code to see it online.
              	Explain the code?
              </p>
      </div>

      <hr id='audio'>

      <div style="text-align:center;">
              <h2>Audio</h2>
              <p style="text-align: left;padding: 0px 30px;">
             <li>We used this microphone < put info on it here >
             <li>We set up the audio < detail steps on how its done >
             <li>It plays on a website.
             <li>Edited the rpi camera code to put the audio on the website as well.
             <li>Comments: the microphone sucks. Possible improvement is to use an earphone's mic instead.
          </p>
      </div>

      <hr id='androidscreen'>

      <div style="text-align:center;">
          <h2>Android Application</h2>
          <p style="text-align: left;padding: 0px 30px;">
            We were able to get the livestream video and audio by using webView on the android phone through this <a href="https://medium.com/@stevesohcot/andriod-studio-webview-tutorial-4651701d7d1a">tutorial</a>. We initially tried to use videoView and vitamio but could not get that to work. 
            <br><br>
            As in the tutorial, we initialized a WebView variable and set it up in the onCreate section as such : 
          </p>
          <div align="left">
            <pre><code>
      public class MainActivity extends AppCompatActivity implements SensorEventListener {
        private WebView webview ;
        ...
        @Override
        protected void onCreate (Bundle savedInstanceState) {
        ...
        webview =(WebView)findViewById(R.id.webView);

        webview.setWebViewClient(new WebViewClient());
        webview.getSettings().setJavaScriptEnabled(true);
        webview.getSettings().setDomStorageEnabled(true);
        webview.setOverScrollMode(WebView.OVER_SCROLL_NEVER);
        webview.loadUrl(videoURL);

       }
      }
            </code></pre>
          </div>
          <p style="text-align: left;padding: 0px 30px;">
            Then, in the activity_main.xml file (under the res/layouts folder), one must also remember to put in a WebView object so that the findViewById" line can find the view and load the website onto that view.
            <br><br>
          </p>
          <h4 style="text-align: left;padding: 0px 30px;">Bugs</h4>
          <p style="text-align: left;padding: 0px 30px;">
            If the phone still cannot access the website, one should check their AndroidManifext.xml file (under the manifests folder) if it has the 
            <b>&lt;uses-permission android:name="android.permission.INTERNET"/&gt;</b> line included. We also found a bug where the phone could not access the website if it was not under the same Cornell Wifi as the robot. So, one should make sure that if the Pi is livestreaming the camera and audio information online under the Cornell Wifi that the phone is also using the Cornell Wifi (not data).
          </p>

      </div>

      <hr id='control'>

      <div style="text-align:center;">
              <h2>Controlling the Robot with a Phone</h2>
              <div class="col-md-4" style="text-align:center;">
              <img class="img-rounded" src="pics/accelerometer.png" alt="Phone coordinate system for sensors" width="240" height="240">
              </div>
              <br>
              <p style="text-align: left;padding: 0px 30px;"> 
              To control the robot wirelessly, we needed to create a socket to send accelerometer information from the phone (the server) to be received by the Raspberry Pi (the client). All code can be either seen in the Code Appendix section or on the <a href="https://github.com/cya6/WifiRobot">github repository</a>.
              </p> 
              <h3>1. Configuring the Phone's Accelerometer </h3>
              <p style="text-align: left;padding: 0px 30px;"> 
                We configured the phone's accelerometer using AndroidStudio to create an application.
                To configure and use the accelerometer within the phone through the app, we followed some tutorials that showed us how to set up and print out the accelerometer values: 
                <br><br>
                <a href="https://www.youtube.com/watch?v=pkT7DU1Yo9Q&t=682s">Set up accelerometer</a>
                <br>
                <a href="https://www.youtube.com/watch?v=Rda_5s4rObQ">Print out accelerometer values</a>
                <br><br>
                
                First, we used an empty template through Android Studio. Then, we followed the tutorial, adding the SensorManager and Sensor variables to the MainActivity class. Next, inside the onCreate function, we configure the SensorManager and Sensor to get information from the phone's accelerometer. Although the tutorial uses the standard default accelerometer, we chose to use the rotation vector accelerometer as it seemed more able to sense turning the phone more easily. An overview of the available sensors on the phone can be seen <a href="https://developer.android.com/guide/topics/sensors/sensors_motion.html">here</a>.
                <br><br>
                We also then configure the SensorManager to allow us listen to the information from the phone's accelerometer. Next, by using the sensor class, there are two functions that must be included in the MainActivity file : onAccuracyChanged and onSensorChanged. For our purposes, we only use onSensorChanged since we only wanted to read the x, y, and z values output by the accelerometer. In the onSensorChanged function, it takes in a sensor event which then contains the x, y, and z values from the sensor. We then save this information by saving the read values to a string.
                <br> 
              </p>
                <div align = "left">
                <pre><code>
public class MainActivity extends AppCompatActivity implements SensorEventListener {

    private static final String TAG = "MainActivity";
    private SensorManager sensorManager;
    private Sensor accelerometer;

    String x,y,z;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        sensorManager = (SensorManager) getSystemService(Context.SENSOR_SERVICE);
        accelerometer = sensorManager.getDefaultSensor(Sensor.TYPE_ROTATION_VECTOR);

        sensorManager.registerListener(MainActivity.this,accelerometer, SensorManager.SENSOR_DELAY_NORMAL);
    }


    @Override
    public void onAccuracyChanged(Sensor sensor, int accuracy) {

    }

    @Override
    public void onSensorChanged(SensorEvent event) {
        Log.d(TAG, "X: " + event.values[0] + " |Y: " + event.values[1]);

        x = "xValue: "+event.values[0];
        y = "yValue: "+event.values[1];
        z = "zValue: "+event.values[2];

    }
                </code></pre>
              </div>
              <p style="text-align: left;padding: 0px 30px;"> 
                To see the accelerometer values for yourself, you can use Log.d to print out the values to Android Studio's Logcat. Next, after setting up the accelerometer on the phone, we needed to send it to the RPi. 
              </p>
              <h3>2. Sending information to the RPi with Socket Programming </h3>

              <h4 style="text-align: left; padding: 0px 30px">Server side ( Android Application )</h4>
              <p style="text-align: left;padding: 0px 30px;"> 
                We used socket programming to send information from the phone to the RPi. The phone was set up as the server by following the information <a href="http://androidsrc.net/android-client-server-using-sockets-server-implementation/">here</a>. 
                <br><br>
                Following this tutorial, after setting up the server as they did, we changed some parts of it to send to the client the accelerometer information continuously. In MainActivity.java, we initialize the server in onCreate. We also include a function that will destroy the server when the application is closed. 
                <div align="left">
                  <pre><code>
        public class MainActivity extends AppCompatActivity implements SensorEventListener {
          Server server ;
          ...

          @Override 
          protected void onCreate(Bundle savedInstanceState) {
            ...
            server = newServer(this);
            ...
          }
          ...

          @Override
          protected void onDestroy() {
              super.onDestroy();
              server.onDestroy();
          }
        }
                  </code></pre>
                </div> <p>
              <p style="text-align: left;padding: 0px 30px;">
                In Server.java, in the run () code section, we see that it has an outputStream that it sends to the Client, in our case the RPi. We change the section to continuously in a while ( true ) loop, print to the outputStream the x, y, and z values recorded in MainActivity. With this, the server has been set up to send across the accelerometer information. We also modified the tutorial code to not print out anything on the application screen.
              </p>
              <div align="left">
                <pre><code>
        @Override
        public void run() {
            OutputStream outputStream ;

            try {
                outputStream = hostThreadSocket.getOutputStream();
                PrintStream printStream = new PrintStream(outputStream);
                while (true) {
                    printStream.println(activity.x + "\n" +
                            activity.y + "\n" +
                            activity.z  + "\n");
                    sleep(1000);
                }
                printStream.close();

            }
            catch (IOException e) {
                e.printStackTrace();
                message += "Something wrong! " + e.toString() + "\n";
            }
            catch (InterruptedException e) {
                e.printStackTrace();
                message += "Something wrong! " + e.toString() + "\n";
            }

            activity.runOnUiThread(new Runnable() {
                @Override
                public void run() {
                    activity.msg.setText(message);
                }
            });
        }
                </code></pre>
              </div>
              <br>
              <h4 style="text-align: left; padding: 0px 30px">Client side ( from the RPi point of view )</h4>
              <p style="text-align: left;padding: 0px 30px;"> 
                To set up the client code on the Raspberry Pi, we followed the "Echo Client" code in this <a href="https://realpython.com/python-sockets/">tutorial</a>.
                <br>
                The HOST value was set to the IP address of the android phone ( which can be found by clicking on the wifi button on your phone ).
                We also made sure it was using the same port as was used on the application side in Server.java. A change we made however was to continuously receive data, decode it into ASCII characters, and then send that information to a FIFO. This FIFO is important as it is what we will use to control the robot with the accelerometer. The code can be seen in our <a href="https://github.com/cya6/WifiRobot">repository</a> under client.py.
              </p>

              <h3>3. Moving the robot with the accelerometer information</h3>
              <p style="text-align: left;padding: 0px 30px;">
                Finally, to move the robot, we read from the FIFO and based on the values from the accelerometer, decide to turn left, right, forward, or backwards. Code for this is found in our repository, under <a href="https://github.com/cya6/WifiRobot/blob/master/project/robot_control.py">robot_control.py</a>.
                <br><br>
                To allow the user to stand in any direction and start moving the robot, we first allow for a calibration period in the beginning where it will set the x and z values read to be the setting for which the user wishes to keep the robot still. 
                <br>
                Next, after it is calibrated, it continues to read lines from the FIFO. We realized that when the phone (set horizontally) is tilted forward, the z value goes up by 0.1 and x value down by 0.1 from its steady state. To prevent from false forwards however, we set the code up so that it must detect this at least twice before it goes forward. Similarly, to go backwards, it detects that the z value goes down by 0.1 and x value up by 0.1 from its steady state. These threshold values were decided on after trial and error and may need to be adjusted if used on another device.
                We also use a buffer here before we actually decide to move the robot backwards. If neither of these conditions are detected, we keep the robot still. 
                <br> <br>
                To go left or right, we depend solely on the x values read from the accelerometer. We also prevent the robot from turning if the user is going forward or backwards at that moment. To go right, we see if the x value goes down by 0.1 and to go left, if it goes up by 0.05. Similarly, this values were also found through trial and error and may need to be adjusted if run on another device. We also use a buffer here to detect more than 2 lefts or rights before the robot will actually turn right or left. If neither are detected, it will remain still. 
                <br>

              </p>
      </div>

    <hr id='testing'>

      <div style="text-align:center;">
              <h2>Testing</h2>
              <p style="text-align: left;padding: 0px 30px;">
                test
              </p>
      </div>

    <hr id='result'>

      <div style="text-align:center;">
              <h2>Result</h2>
              <p style="text-align: left;padding: 0px 30px;">
                final res
              </p>
      </div>

    <hr>

    <div class="row" style="text-align:center;">
          <h2>Work Distribution</h2>
          <div style="text-align:center;">
              <img class="img-rounded" src="pics/group.jpg" alt="Generic placeholder image" style="width:80%;">
              <h4>Project group picture</h4>
          </div>
          <div class="col-md-6" style="font-size:16px">
              <img class="img-rounded" src="pics/a.png" alt="Generic placeholder image" width="240" height="240">
              <h3>Christine</h3>
              <p class="lead">cya6@cornell.edu</p>
              <p>Worked on the robot.
          </div>
          <div class="col-md-6" style="font-size:16px">
              <img class="img-rounded" src="pics/b.png" alt="Generic placeholder image" width="240" height="240">
              <h3>Sophie</h3>
              <p class="lead">bh377@cornell.edu</p>
              <p>Hugged christine
          </div>
      </div>

    <hr>
      <div style="font-size:18px">
          <h2>Parts List</h2>
          <ul>
              <li>Raspberry Pi $35.00</li>
              <li>Raspberry Pi Camera V2 $25.00</li>
              
              <li>LEDs, Resistors and Wires - Provided in lab</li>
          </ul>
          <h3>Total: $?</h3>
      </div>
      <hr>
      <div style="font-size:18px">
          <h2>References</h2>
          <a href="https://picamera.readthedocs.io/">PiCamera Document</a><br>
          <a href="https://www.youtube.com/watch?v=pkT7DU1Yo9Q&t=682s">Accelerometer Tutorial 1
          </a><br>
          <a href="https://www.youtube.com/watch?v=Rda_5s4rObQ">Accelerometer Tutorial 2
          </a><br>
          <a href="https://developer.android.com/guide/topics/sensors/sensors_motion.html"> Android Sensor Information
          </a><br>
          <a href="http://androidsrc.net/android-client-server-using-sockets-server-implementation/"> Android Socket Programming
          </a><br>
          <a href="https://realpython.com/python-sockets/"> Python Socket Programming
          </a><br>


      </div>

    <hr>

      <div class="row">
              <h2>Code Appendix</h2>
              <h3><a href="https://github.com/cya6/WifiRobot/blob/master/project/robot_control.py">Robot Control Code</a> </h3>
              <h3><a href="https://github.com/cya6/WifiRobot/blob/master/project/client.py">Client Code</a> </h3>
              <h3><a href="https://github.com/cya6/WifiRobot/blob/master/project/rpi_camera.py">Camera Code</a> </h3>
      </div>

    </div><!-- /.container -->




    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="dist/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <!-- <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script> -->
  </body>
</html>
